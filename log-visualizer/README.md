# Python State Debugger

A Next.js application that visualizes log files generated by Python classes decorated with `@snapshot_class`. This provides a time travel debugger interface to explore how class state changes over time.

## Features

- **Time Travel Debugging**: Navigate through state changes step by step
- **Visual State Representation**: See current object state with syntax highlighting
- **Change Highlighting**: Highlighted fields that changed in each step
- **Before/After Diff**: See what values changed from and to
- **Timeline Overview**: Quick navigation to any point in the execution
- **Sample Data**: Built-in sample data for testing

## Getting Started

1. **Install dependencies**:
```bash
npm install
```

2. **Run the development server**:
```bash
npm run dev
```

3. **Open your browser** and go to [http://localhost:3000](http://localhost:3000)

## How to Use

### Step 1: Generate Log Data

Use the provided Python decorator to generate log files:

```python
#!/usr/bin/env python3
import copy
import functools
import json
import os

LOG_PATH = "/tmp/log.txt"

def snapshot_class(cls):
    """
    Decorator for a class: every method call snapshots self.__dict__ before
    and after, computes a diff, and logs JSON records to /tmp/log.txt
    """
    def diff_dict(before, after):
        diffs = {}
        all_keys = set(before.keys()) | set(after.keys())
        for k in all_keys:
            if before.get(k) != after.get(k):
                diffs[k] = {"before": before.get(k), "after": after.get(k)}
        return diffs

    def wrap_method(name, func):
        @functools.wraps(func)
        def wrapper(self, *args, **kwargs):
            before = copy.deepcopy(self.__dict__)
            result = func(self, *args, **kwargs)
            after = copy.deepcopy(self.__dict__)
            changes = diff_dict(before, after)
            if changes:
                record = {
                    "class": cls.__name__,
                    "method": name,
                    "changes": changes,
                }
                with open(LOG_PATH, "a") as f:
                    f.write(json.dumps(record) + "\n")
            return result
        return wrapper

    for attr_name, attr_value in list(vars(cls).items()):
        if callable(attr_value) and not attr_name.startswith("__"):
            setattr(cls, attr_name, wrap_method(attr_name, attr_value))

    return cls

# Example usage
@snapshot_class
class MyClass:
    def __init__(self, x):
        self.x = x
        self.y = 0
        self.history = []

    def increment(self, amount):
        self.x += amount
        self.y += 1

    def add_to_history(self, item):
        self.history.append(item)

    def reset(self):
        self.x = 0
        self.y = 0
        self.history.clear()

if __name__ == "__main__":
    # Ensure log file is empty at the start
    if os.path.exists(LOG_PATH):
        os.remove(LOG_PATH)

    obj = MyClass(10)
    obj.increment(5)
    obj.add_to_history("first")
    obj.add_to_history("second")
    obj.reset()
```

### Step 2: Load the Log File

1. Run your Python script to generate `/tmp/log.txt`
2. In the web interface, click "Upload log.txt file" and select your log file
3. Alternatively, click "Load Sample Data" to see the interface with example data

### Step 3: Explore State Changes

- Use **Previous/Next** buttons to step through changes
- Use the **timeline slider** for quick navigation
- Click on any item in the **Timeline Overview** to jump to that step
- **Yellow highlighting** shows fields that changed in the current step
- **Before/After** sections show the exact value changes

## Project Structure

```
src/
├── app/
│   ├── globals.css          # Global styles and slider styling
│   └── page.tsx             # Main application page
├── components/
│   ├── LogFileLoader.tsx    # File upload and sample data component
│   ├── StateVisualization.tsx # State display with syntax highlighting
│   └── TimeControls.tsx     # Time travel navigation controls
├── lib/
│   └── logParser.ts         # Log file parsing and state reconstruction
└── types/
    └── log.ts               # TypeScript type definitions
```

## Log File Format

The application expects JSON log entries with this structure:

```json
{
  "class": "ClassName",
  "method": "methodName",
  "changes": {
    "fieldName": {
      "before": "previous_value",
      "after": "new_value"
    }
  }
}
```
